<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Variation mensuelle cryptos Binance</title>
<style>
body {
font-family: Arial, sans-serif;
margin: 20px;
background: #f5f5f5;
}
table {
border-collapse: collapse;
width: 100%;
background: white;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
th, td {
border: 1px solid #ddd;
padding: 8px;
text-align: center;
}
th {
background-color: #4CAF50;
color: white;
position: sticky;
top: 0;
}
tr:hover {
background-color: #f1f1f1;
}
.positive {
color: green;
}
.negative {
color: red;
}
.card {
margin-top: 20px;
padding: 15px;
border-radius: 8px;
background: white;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
.card-title {
font-weight: bold;
margin-bottom: 10px;
}
.card-content {
display: flex;
flex-wrap: wrap;
gap: 10px;
}
.month-card {
padding: 10px;
border-radius: 4px;
min-width: 120px;
}
.max-column {
background-color: #e6ffe6;
font-weight: bold;
}
.min-column {
background-color: #ffebeb; /* Fond rouge clair */
font-weight: bold;
}
.max-column-header {
background-color: #4CAF50;
color: white;
font-weight: bold;
}
.min-column-header {
background-color: #4CAF50;
color: white;
font-weight: bold;
}
</style>
</head>
<body>
<h1>Variation mensuelle des cryptos (Binance) - 2025 (long)</h1>
<p>Données dynamiques avec API Binance - Taux de variation (%) par mois</p>

<!-- Somme des variations mensuelles -->
<div class="card" style="margin-bottom: 10px;">
<div class="card-title">Somme des variations mensuelles</div>
<div class="card-content" id="monthlySumCards"></div>
</div>

<!-- Somme des mèches plus haut variations mensuelles -->
<div class="card" style="margin-bottom: 10px;">
<div class="card-title">Somme des mèches plus haut variations mensuelles</div>
<div class="card-content" id="highWickSumCards"></div>
</div>

<!-- NOUVELLE CARD : Somme des mèches plus bas variations mensuelles -->
<div class="card" style="margin-bottom: 10px;">
<div class="card-title">Somme des mèches plus bas variations mensuelles</div>
<div class="card-content" id="lowWickSumCards"></div>
</div>

<div id="loading">Chargement des données...</div>
<table id="cryptoTable">
<thead>
<tr id="headerRow">
<th>Crypto</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const cryptoList = [/*
  "OMUSDT",*/
  "OMUSDT",
  /*
  "PEPEUSDT",
  "SUIUSDT",
  "FLOKIUSDT",
  "JASMYUSDT",
  "RSRUSDT",
  "PENDLEUSDT",
  "DEXEUSDT",
  "RAYUSDT",
  "PEOPLEUSDT"*/
];

const uniqueCryptos = [...new Set(cryptoList)].sort();
const moisFrancais = [
"Janvier", "Février", "Mars", "Avril", "Mai", "Juin",
"Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"
];
let allMonths = new Set();

async function fetchMonthlyData(symbol) {
try {
const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1M`;
const response = await fetch(url);
if (!response.ok) {
throw new Error(`Erreur HTTP: ${response.status}`);
}
const data = await response.json();
return data.map(candle => {
const openTime = new Date(candle[0]);
const open = parseFloat(candle[1]);
const high = parseFloat(candle[2]);
const low = parseFloat(candle[3]);
const close = parseFloat(candle[4]);
const variation = ((close - open) / open * 100).toFixed(2);
const highVariation = ((high - open) / open * 100).toFixed(2);
const lowVariation = ((low - open) / open * 100).toFixed(2);
const monthYear = `${moisFrancais[openTime.getMonth()]} ${openTime.getFullYear()}`;
if (openTime.getFullYear() === 2025) {
allMonths.add(monthYear);
return {
monthYear,
variation: parseFloat(variation),
highVariation: parseFloat(highVariation),
lowVariation: parseFloat(lowVariation)
};
}
return null;
}).filter(Boolean);
} catch (error) {
console.error(`Erreur lors de la récupération des données pour ${symbol}:`, error);
return [];
}
}

async function buildTable() {
const loadingElement = document.getElementById("loading");
const tableBody = document.getElementById("tableBody");
const monthlySumCards = document.getElementById("monthlySumCards");
const highWickSumCards = document.getElementById("highWickSumCards");
const lowWickSumCards = document.getElementById("lowWickSumCards");

try {
loadingElement.textContent = "Chargement des données...";
const results = {};
await Promise.all(uniqueCryptos.map(async (crypto) => {
results[crypto] = await fetchMonthlyData(crypto);
}));

const sortedMonths = Array.from(allMonths).sort((a, b) => {
const [moisA] = a.split(" ");
const [moisB] = b.split(" ");
return moisFrancais.indexOf(moisA) - moisFrancais.indexOf(moisB);
});

// Ajouter les headers
const headerRow = document.getElementById("headerRow");
sortedMonths.forEach(m => {
const thMonth = document.createElement("th");
thMonth.textContent = m;
headerRow.appendChild(thMonth);

const thMax = document.createElement("th");
thMax.textContent = `Mèche plus haut ${m}`;
thMax.className = "max-column-header";
headerRow.appendChild(thMax);

const thMin = document.createElement("th");
thMin.textContent = `Mèche plus bas ${m}`;
thMin.className = "min-column-header";
headerRow.appendChild(thMin);
});

// Remplir le tableau
const monthlySums = {};
const monthlyHighWickSums = {};
const monthlyLowWickSums = {};

uniqueCryptos.forEach(crypto => {
const tr = document.createElement("tr");
const tdName = document.createElement("td");
tdName.textContent = crypto;
tr.appendChild(tdName);

sortedMonths.forEach(month => {
const tdVariation = document.createElement("td");
const moisData = results[crypto].find(d => d.monthYear === month);

if (moisData) {
tdVariation.textContent = `${moisData.variation}%`;
tdVariation.className = moisData.variation >= 0 ? 'positive' : 'negative';

// Somme des variations mensuelles
if (!monthlySums[month]) monthlySums[month] = 0;
monthlySums[month] += moisData.variation;

// Somme des mèches plus haut
if (!monthlyHighWickSums[month]) monthlyHighWickSums[month] = 0;
monthlyHighWickSums[month] += moisData.highVariation;

// Somme des mèches plus bas
if (!monthlyLowWickSums[month]) monthlyLowWickSums[month] = 0;
monthlyLowWickSums[month] += moisData.lowVariation;
} else {
tdVariation.textContent = "-";
}
tr.appendChild(tdVariation);

// Ajouter la colonne mèche haute
const tdMax = document.createElement("td");
if (moisData) {
tdMax.textContent = `${moisData.highVariation}%`;
tdMax.className = "max-column positive";
} else {
tdMax.textContent = "-";
}
tr.appendChild(tdMax);

// Ajouter la colonne mèche basse
const tdMin = document.createElement("td");
if (moisData) {
tdMin.textContent = `${moisData.lowVariation}%`;
tdMin.className = "min-column negative"; // Fond rouge clair + texte rouge
} else {
tdMin.textContent = "-";
}
tr.appendChild(tdMin);
});
tableBody.appendChild(tr);
});

// Afficher les sommes mensuelles (variations)
for (const month in monthlySums) {
const sum = monthlySums[month];
const monthCard = document.createElement("div");
monthCard.className = `month-card ${sum >= 0 ? 'positive' : 'negative'}`;
monthCard.textContent = `${month}: ${sum.toFixed(2)}%`;
monthlySumCards.appendChild(monthCard);
}

// Afficher les sommes mensuelles (mèches plus haut)
for (const month in monthlyHighWickSums) {
const sum = monthlyHighWickSums[month];
const monthCard = document.createElement("div");
monthCard.className = `month-card ${sum >= 0 ? 'positive' : 'negative'}`;
monthCard.textContent = `${month}: ${sum.toFixed(2)}%`;
highWickSumCards.appendChild(monthCard);
}

// Afficher les sommes mensuelles (mèches plus bas)
for (const month in monthlyLowWickSums) {
const sum = monthlyLowWickSums[month];
const monthCard = document.createElement("div");
monthCard.className = `month-card ${sum >= 0 ? 'positive' : 'negative'}`;
monthCard.textContent = `${month}: ${sum.toFixed(2)}%`;
lowWickSumCards.appendChild(monthCard);
}

} catch (error) {
console.error("Erreur lors de la construction du tableau:", error);
loadingElement.textContent = "Erreur lors du chargement des données.";
} finally {
loadingElement.style.display = "none";
}
}

buildTable();
</script>
</body>
</html>