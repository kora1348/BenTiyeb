<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cryptos TRY sur Binance</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; color: #333; }
    .notification {
      background-color: #fff3cd; color: #856404; padding: 15px;
      border-radius: 5px; margin-bottom: 20px; border-left: 5px solid #ffeeba;
    }
    table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-top: 20px; }
    th, td { padding: 12px 15px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #f2a900; color: white; }
    tr:hover { background-color: #f5f5f5; }
    .positive { color: green; }
    .negative { color: red; }
    .loading { text-align: center; font-style: italic; color: #666; padding: 20px; }
    .last-update { text-align: right; font-size: 0.8em; color: #666; margin-top: 10px; }
    .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .crypto-list { list-style: none; padding: 0; }
    .crypto-list li { padding: 8px 0; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>

<h1>Cryptos avec paire TRY sur Binance</h1>

<div class="notification">
  <strong>Information importante :</strong> Cette interface affiche les données pour les dates du <span id="date1"></span> et <span id="date2"></span>.
</div>

<div class="card" id="cryptoCard" style="display: none;">
  <h2>Cryptos avec symbole correspondant: <span id="symboleATrouver"></span></h2>
  <ul class="crypto-list" id="cryptoList"></ul>
</div>

<div id="loading" class="loading">Chargement des données en cours...</div>

<table id="cryptoTable" style="display: none;">
  <thead>
    <tr><th>#</th><th>Crypto</th><th>Lundi</th><th>Mardi</th></tr>
  </thead>
  <tbody id="cryptoTableBody"></tbody>
</table>

<div id="lastUpdate" class="last-update"></div>

<script>
document.addEventListener('DOMContentLoaded', async function () {
  const tableBody = document.getElementById('cryptoTableBody');
  const loadingDiv = document.getElementById('loading');
  const cryptoTable = document.getElementById('cryptoTable');
  const lastUpdateDiv = document.getElementById('lastUpdate');
  const cryptoCard = document.getElementById('cryptoCard');
  const cryptoList = document.getElementById('cryptoList');
  const date1Span = document.getElementById('date1');
  const date2Span = document.getElementById('date2');
  const symboleATrouverSpan = document.getElementById('symboleATrouver');

  const symboleATrouver = '+'; // ou '-'
  const date1 = new Date('2025-07-01');
  const date2 = new Date('2025-07-02');

  date1Span.textContent = date1.toLocaleDateString('fr-FR');
  date2Span.textContent = date2.toLocaleDateString('fr-FR');
  symboleATrouverSpan.textContent = symboleATrouver;

  async function getVariation(symbol, date) {
    const start = new Date(date);
    start.setUTCHours(0, 0, 0, 0);
    const end = new Date(start);
    end.setUTCDate(start.getUTCDate() + 1);

    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1d&startTime=${start.getTime()}&endTime=${end.getTime()}`;
    const res = await fetch(url);
    const data = await res.json();
    if (!Array.isArray(data) || data.length === 0) return null;

    const open = parseFloat(data[0][1]);
    const close = parseFloat(data[0][4]);
    return ((close - open) / open) * 100;
  }

  async function loadData() {
    loadingDiv.style.display = 'block';
    cryptoTable.style.display = 'none';
    cryptoCard.style.display = 'none';
    tableBody.innerHTML = '';
    cryptoList.innerHTML = '';

    try {
      const res = await fetch('https://api.binance.com/api/v3/ticker/24hr');
      const data = await res.json();
      const tryPairs = data.filter(pair => pair.symbol.endsWith('TRY'));

      const results = await Promise.allSettled(tryPairs.map(async pair => {
        const symbol = pair.symbol;
        const lundi = await getVariation(symbol, date1);
        const mardi = await getVariation(symbol, date2);
        return { symbol, lundi, mardi };
      }));

      let index = 1;
      results.forEach(result => {
        if (result.status !== 'fulfilled') return;
        const { symbol, lundi, mardi } = result.value;
        if (lundi === null || mardi === null) return;

        const row = document.createElement('tr');

        const indexCell = document.createElement('td');
        indexCell.textContent = index++;

        const symbolCell = document.createElement('td');
        symbolCell.textContent = symbol.replace('TRY', '');

        const cellLundi = document.createElement('td');
        cellLundi.textContent = (lundi >= 0 ? '+' : '') + lundi.toFixed(2) + '%';
        cellLundi.classList.add(lundi >= 0 ? 'positive' : 'negative');

        const cellMardi = document.createElement('td');
        cellMardi.textContent = (mardi >= 0 ? '+' : '') + mardi.toFixed(2) + '%';
        cellMardi.classList.add(mardi >= 0 ? 'positive' : 'negative');

        row.append(indexCell, symbolCell, cellLundi, cellMardi);
        tableBody.appendChild(row);

        if ((lundi >= 0 ? '+' : '-') === symboleATrouver || (mardi >= 0 ? '+' : '-') === symboleATrouver) {
          const item = document.createElement('li');
          item.textContent = symbol.replace('TRY', '');
          cryptoList.appendChild(item);
        }
      });

      loadingDiv.style.display = 'none';
      cryptoTable.style.display = 'table';
      if (cryptoList.children.length > 0) cryptoCard.style.display = 'block';
      lastUpdateDiv.textContent = 'Dernière mise à jour : ' + new Date().toLocaleString('fr-FR');
    } catch (err) {
      loadingDiv.textContent = 'Erreur : ' + err.message;
    }
  }

  await loadData();
});
</script>
</body>
</html>
