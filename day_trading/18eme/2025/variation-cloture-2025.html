<!DOCTYPE html>
<html lang="fr">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Taux de variation (Daily) â€” Futures USDT-M</title>
      <style>
         /* mÃªmes styles que ton codeâ€¦ (inchangÃ©s) */
         *{margin:0;padding:0;box-sizing:border-box}
         body{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
         .container{background:white;border-radius:20px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,.3);max-width:1400px;width:100%}
         h1{text-align:center;color:#333;margin-bottom:30px;font-size:28px}
         table{width:100%;border-collapse:collapse;margin-bottom:20px;background:white;border-radius:10px;overflow:hidden}
         thead{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white}
         th{padding:15px 10px;text-align:center;font-weight:bold;font-size:14px}
         td{padding:15px 10px;text-align:center;border-bottom:1px solid #eee;font-size:14px}
         tbody tr:last-child td{border-bottom:none}
         tbody tr:hover{background:#f8f9fa}
         .symbol{font-weight:bold;color:#333}
         .positive{color:#22c55e;font-weight:bold}
         .negative{color:#ef4444;font-weight:bold}
         .loading{text-align:center;color:#666;padding:20px}
         .error{background:#fee;border:1px solid #fcc;color:#c33;padding:15px;border-radius:10px;margin-bottom:20px}
         button{width:100%;padding:15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;transition:transform .2s}
         button:hover{transform:translateY(-2px)}
         button:disabled{opacity:.5;cursor:not-allowed}
         .progress-container{width:100%;background:#e5e7eb;border-radius:10px;height:30px;overflow:hidden;margin-bottom:20px;box-shadow:inset 0 2px 4px rgba(0,0,0,.1)}
         .progress-bar{height:100%;background:linear-gradient(90deg,#667eea 0%,#764ba2 100%);border-radius:10px;transition:width .3s ease;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:12px}
         .year-badge{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:5px 15px;border-radius:20px;font-size:12px;font-weight:bold;display:inline-block;margin-bottom:10px}
      </style>
   </head>
   <body>
      <div class="container">
         <h1>ðŸ“Š Taux de variation (Bougies Daily - 18)</h1>
         <div style="text-align:center;"><span class="year-badge">AnnÃ©e 2025</span></div>
         <div id="progressContainer" style="display:none;">
            <div class="progress-container">
               <div id="progressBar" class="progress-bar" style="width:0%;">0%</div>
            </div>
         </div>
         <div id="content">
            <div class="loading">Chargement des donnÃ©es...</div>
         </div>
         <button id="refreshBtn" onclick="fetchData()">ðŸ”„ Actualiser</button>
            <p>R + R + R + R + R + R </p>
      </div>
      <script>
         // âœ… 1) Utiliser l'API FUTURES (USDT-M)
         const API = 'https://fapi.binance.com';
         
         // âœ… 2) Toujours normaliser les symboles en MAJUSCULE
         const U = s => s.trim().toUpperCase();
         
         async function getKline(symbol, date) {
           const startOfDay = new Date(date);     // 'YYYY-MM-DD' -> locale
           startOfDay.setUTCHours(0,0,0,0);       // on force l'UTC de 00:00
           const endOfDay = new Date(date);
           endOfDay.setUTCHours(23,59,59,999);    // jusqu'Ã  23:59:59 UTC
         
           const url = `${API}/fapi/v1/klines?symbol=${U(symbol)}&interval=1d&startTime=${startOfDay.getTime()}&endTime=${endOfDay.getTime()}&limit=1`;
           const res = await fetch(url);
           if (!res.ok) throw new Error(`Erreur API pour ${symbol} (${res.status})`);
           const data = await res.json();
           return data[0]; // peut Ãªtre undefined si pas de donnÃ©e ce jour-lÃ 
         }
         
         function calculateDailyVariation(kline) {
           const open = parseFloat(kline[1]);
           const close = parseFloat(kline[4]);
           return ((close - open) / open) * 100;
         }
         
         async function fetchData() {
           const content = document.getElementById('content');
           const btn = document.getElementById('refreshBtn');
           const progressContainer = document.getElementById('progressContainer');
           const progressBar = document.getElementById('progressBar');
         
           btn.disabled = true;
           content.innerHTML = '';
           progressContainer.style.display = 'block';
           progressBar.style.width = '0%';
           progressBar.textContent = '0%';
         
           try {
            const symbols = [
             "AEVOUSDT","ARPAUSDT","AXLUSDT","DIAUSDT","EGLDUSDT","IDUSDT","RONINUSDT","WLDUSDT",
         "1000satsusdt", "1000luncusdt", 
         "ANKRUSDT","DENTUSDT",
         "ENJUSDT", "NXPCUSDT",
         
         ];
         
         
             const dates = [
               '2025-02-04','2025-02-11','2025-07-04', '2025-07-07',
               '2025-10-03','2025-10-07'
             ];
         
             const totalRequests = symbols.length * dates.length;
             let completedRequests = 0;
         
             const allPromises = [];
         
             for (const symbol of symbols) {
               for (const date of dates) {
                 allPromises.push(
                   getKline(symbol, date)
                     .then(kline => {
                       completedRequests++;
                       const progress = Math.round((completedRequests / totalRequests) * 100);
                       progressBar.style.width = progress + '%';
                       progressBar.textContent = progress + '%';
                       return kline ? calculateDailyVariation(kline) : null;
                     })
                     .catch(() => {
                       completedRequests++;
                       const progress = Math.round((completedRequests / totalRequests) * 100);
                       progressBar.style.width = progress + '%';
                       progressBar.textContent = progress + '%';
                       return null; // non listÃ© / pas de donnÃ©es / rate-limit
                     })
                 );
               }
             }
         
             const allVariations = await Promise.all(allPromises);
         
             // Regrouper par symbole
             const results = [];
             for (let i = 0; i < symbols.length; i++) {
               const variations = allVariations.slice(i * dates.length, (i + 1) * dates.length);
               results.push({
                 // affichage lisible : on montre le ticker en MAJ
                 symbol: U(symbols[i]),
                 variations
               });
             }
         
             progressContainer.style.display = 'none';
         
             let tableHTML = `
               <table>
                 <thead>
                   <tr>
                     <th>Symbole</th>
                     <th>04/02/2025</th><th>11/02/2025</th>
                     <th>04/07/2025</th><th>07/07/2025</th>
                     <th>03/10/2025</th><th>07/10/2025</th>
                   </tr>
                 </thead>
                 <tbody>
             `;
         
             // Calculer les totaux par colonne
             const totals = new Array(dates.length).fill(0);
             const counts = new Array(dates.length).fill(0);
             
             results.forEach(r => {
               tableHTML += `<tr><td class="symbol">${r.symbol}</td>`;
               r.variations.forEach((v, idx) => {
                 if (v === null || !isFinite(v)) {
                   tableHTML += `<td style="color:#9ca3af;">N/A</td>`;
                 } else {
                   const cls = v >= 0 ? 'positive' : 'negative';
                   const sign = v >= 0 ? '+' : '';
                   tableHTML += `<td class="${cls}">${sign}${v.toFixed(2)}%</td>`;
                   totals[idx] += v;
                   counts[idx]++;
                 }
               });
               tableHTML += `</tr>`;
             });
         
             // Ajouter la ligne de total
             tableHTML += `<tr style="background:#f3f4f6;font-weight:bold;border-top:3px solid #667eea;">`;
             tableHTML += `<td class="symbol">TOTAL</td>`;
             totals.forEach((total, idx) => {
               if (counts[idx] === 0) {
                 tableHTML += `<td style="color:#9ca3af;">N/A</td>`;
               } else {
                 const cls = total >= 0 ? 'positive' : 'negative';
                 const sign = total >= 0 ? '+' : '';
                 tableHTML += `<td class="${cls}">${sign}${total.toFixed(2)}%</td>`;
               }
             });
             tableHTML += `</tr>`;
         
             tableHTML += `</tbody></table>`;
             content.innerHTML = tableHTML;
         
           } catch (err) {
             progressContainer.style.display = 'none';
             content.innerHTML = `<div class="error"><strong>Erreur:</strong> ${err.message}</div>`;
           } finally {
             btn.disabled = false;
           }
         }
         
         fetchData();
      </script>
   </body>
</html>