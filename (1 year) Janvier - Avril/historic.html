<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Historique annuel Binance - Liste compl√®te</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background-color: #eee; }
#progressContainer {
width: 100%;
background-color: #ddd;
border-radius: 8px;
overflow: hidden;
margin-bottom: 10px;
}
#progressBar {
height: 20px;
width: 0%;
background-color: #4caf50;
text-align: center;
color: white;
font-size: 12px;
line-height: 20px;
transition: width 0.3s ease;
}
#alertGreen div { color: green; margin-bottom: 4px; }
#alertRed div { color: red; margin-bottom: 4px; }
#alertsContainer { display: flex; gap: 40px; margin-top: 20px; }
#alertGreen, #alertRed { flex: 1; }
#alertGreen h3, #alertRed h3 {
margin-bottom: 8px;
border-bottom: 1px solid #ccc;
padding-bottom: 4px;
}
</style>
</head>
<body>

<h2>Alertes : Cryptos avec variation annuelle</h2>

<div id="progressContainer">
<div id="progressBar">0%</div>
</div>

<div id="alertsContainer">
<div id="alertGreen">
<h3>Variations entre -70% et -78% (Vert)</h3>
</div>
<div id="alertRed">
<h3>Variations ‚â• 10000% (Rouge)</h3>
</div>
</div>

<table>
<thead>
<tr>
<th>Crypto</th>
<th>Ann√©e</th>
<th>Taux de variation annuelle (%)</th>
<th>Cl√¥ture d√©cembre</th>
</tr>
</thead>
<tbody id="cryptoTableBody"></tbody>
</table>

<script>
function getYear(timestamp) {
    return new Date(timestamp).getFullYear();
}

async function fetchUsdtSymbols() {
    const resp = await fetch('https://api.binance.com/api/v3/exchangeInfo');
    if (!resp.ok) throw new Error('Erreur r√©cup√©ration exchangeInfo');
    const data = await resp.json();
    return data.symbols
        .filter(s => s.status === 'TRADING' && s.symbol.endsWith('USDT') && s.isSpotTradingAllowed)
        .map(s => s.symbol);
}

async function fetchMonthlyKlines(symbol) {
    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1M&limit=1000`;
    const resp = await fetch(url);
    if (!resp.ok) throw new Error(`Erreur API pour ${symbol} : ${resp.status}`);
    return resp.json();
}

function updateProgress(current, total) {
    const progressBar = document.getElementById('progressBar');
    const percent = Math.round((current / total) * 100);
    progressBar.style.width = percent + '%';
    progressBar.textContent = percent + '%';
}

async function main() {
    const alertGreenDiv = document.getElementById('alertGreen');
    const alertRedDiv = document.getElementById('alertRed');
    const tbody = document.getElementById('cryptoTableBody');
    tbody.innerHTML = '';
    alertGreenDiv.innerHTML = '<h3>Variations entre -70% et -78% (Vert)</h3>';
    alertRedDiv.innerHTML = '<h3>Variations ‚â• 10000% (Rouge)</h3>';

    let alertsGreen = [];
    let alertsRed = [];

    try {
        let symbols = await fetchUsdtSymbols();

        // üîπ TRI ALPHAB√âTIQUE
        symbols.sort();

        const total = symbols.length;
        let processed = 0;

        for (const symbol of symbols) {
            try {
                const klines = await fetchMonthlyKlines(symbol);
                if (klines.length === 0) {
                    tbody.insertAdjacentHTML('beforeend', `<tr><td>${symbol}</td><td colspan="3">Pas de donn√©es</td></tr>`);
                    processed++;
                    updateProgress(processed, total);
                    continue;
                }

                const closeDecByYear = {};
                for (const kline of klines) {
                    const [openTime,, , , close] = kline;
                    const date = new Date(openTime);
                    if (date.getMonth() === 11) {
                        closeDecByYear[date.getFullYear()] = parseFloat(close);
                    }
                }

                const years = Object.keys(closeDecByYear).map(y => parseInt(y)).sort((a,b) => a-b);
                for (let i = 1; i < years.length; i++) {
                    const year = years[i];
                    const prevYear = years[i - 1];
                    const closeCurrent = closeDecByYear[year];
                    const closePrev = closeDecByYear[prevYear];
                    if (!closeCurrent || !closePrev) continue;

                    const variation = ((closeCurrent - closePrev) / closePrev) * 100;

                    if (variation >= -78 && variation <= -70) {
                        alertsGreen.push({ symbol, year, variation: variation.toFixed(2) });
                    }
                    if (variation >= 10000) {
                        alertsRed.push({ symbol, year, variation: variation.toFixed(2) });
                    }

                    const color = (variation >= -78 && variation <= -70) ? 'green' : (variation >= 10000 ? 'red' : '');
                    tbody.insertAdjacentHTML('beforeend', `
                        <tr>
                            <td>${symbol}</td>
                            <td>${year}</td>
                            <td style="color:${color}">${variation.toFixed(2)}%</td>
                            <td>${closeCurrent.toFixed(2)}</td>
                        </tr>
                    `);
                }
            } catch (e) {
                tbody.insertAdjacentHTML('beforeend', `<tr><td>${symbol}</td><td colspan="3" style="color:red;">Erreur: ${e.message}</td></tr>`);
            }

            processed++;
            updateProgress(processed, total);
        }

        alertsGreen.sort((a,b) => a.year - b.year);
        alertGreenDiv.innerHTML = '<h3>Variations entre -70% et -78% (Vert)</h3>';
        if (alertsGreen.length > 0) {
            alertsGreen.forEach(a => {
                alertGreenDiv.insertAdjacentHTML('beforeend', `<div>${a.symbol} : ${a.variation}% en ${a.year}</div>`);
            });
        } else {
            alertGreenDiv.insertAdjacentHTML('beforeend', '<div>Aucune variation annuelle entre -70% et -78% d√©tect√©e.</div>');
        }

        alertsRed.sort((a,b) => a.year - b.year);
        alertRedDiv.innerHTML = '<h3>Variations ‚â• 10000% (Rouge)</h3>';
        if (alertsRed.length > 0) {
            alertsRed.forEach(a => {
                alertRedDiv.insertAdjacentHTML('beforeend', `<div>${a.symbol} : ${a.variation}% en ${a.year}</div>`);
            });
        } else {
            alertRedDiv.insertAdjacentHTML('beforeend', '<div>Aucune variation annuelle ‚â• 10000% d√©tect√©e.</div>');
        }

    } catch (e) {
        alertGreenDiv.innerHTML = '';
        alertRedDiv.innerHTML = '';
        alertGreenDiv.insertAdjacentHTML('beforeend', `<div style="color:red;">Erreur globale : ${e.message}</div>`);
    }
}

main();
</script>

</body>
</html>
