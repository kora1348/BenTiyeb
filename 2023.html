<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Variations mensuelles Binance 2023</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background-color: #eee; }
#progressContainer {
    width: 100%;
    background-color: #ddd;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 10px;
}
#progressBar {
    height: 20px;
    width: 0%;
    background-color: #4caf50;
    text-align: center;
    color: white;
    font-size: 12px;
    line-height: 20px;
    transition: width 0.3s ease;
}
.card {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 12px;
    background-color: #f9f9f9;
    margin-bottom: 15px;
}
.card h3 {
    margin-top: 0;
}
.card div {
    padding: 2px 0;
    border-bottom: 1px solid #eee;
}
</style>
</head>
<body>

<h2>Variations mensuelles (Janvier, Avril, Juillet, Octobre 2023)</h2>

<div id="progressContainer">
    <div id="progressBar">0%</div>
</div>

<div class="card">
    <h3>üìà Cryptos positives sur les 4 mois cons√©cutifs</h3>
    <div id="positiveCryptos">Chargement...</div>
</div>

<table>
<thead>
<tr>
    <th>Crypto</th>
    <th>Mois</th>
    <th>Variation (%)</th>
</tr>
</thead>
<tbody id="cryptoTableBody"></tbody>
</table>

<script>
// Liste pr√©cise des cryptos √† traiter
const targetCryptos = [
  "ACMUSDT","AGLDUSDT","ASRUSDT","ASTRUSDT","ATMUSDT","AVAUSDT","BARUSDT","BNBUSDT",
  "CHZUSDT","DEXEUSDT","DOGEUSDT","DYDXUSDT","EURUSDT","FORTHUSDT","ICPUSDT","ICXUSDT",
  "JUVUSDT","MBLUSDT","PAXGUSDT","POLYXUSDT","PONDUSDT","QIUSDT","SANTOSUSDT","SCUSDT",
  "SOLUSDT","STEEMUSDT","STGUSDT","TRXUSDT","XVSUSDT"
];

// Mois cibl√©s
const monthsToShow = [0, 3, 6, 9]; // Janvier, Avril, Juillet, Octobre

async function fetchMonthlyKlines(symbol) {
    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1M&limit=1000`;
    const resp = await fetch(url);
    return resp.json();
}

function updateProgress(current, total) {
    const progressBar = document.getElementById('progressBar');
    const percent = Math.round((current / total) * 100);
    progressBar.style.width = percent + '%';
    progressBar.textContent = percent + '%';
}

async function main() {
    const tbody = document.getElementById('cryptoTableBody');
    const positiveDiv = document.getElementById('positiveCryptos');
    tbody.innerHTML = '';
    positiveDiv.innerHTML = 'Chargement...';

    let processed = 0;
    let positiveList = [];

    // Tri alphab√©tique de la liste donn√©e
    targetCryptos.sort();

    for (const symbol of targetCryptos) {
        try {
            const klines = await fetchMonthlyKlines(symbol);
            let positiveCount = 0;
            let totalVariation = 0;

            for (let i = 1; i < klines.length; i++) {
                const prev = klines[i - 1];
                const curr = klines[i];
                const date = new Date(curr[0]);
                const year = date.getFullYear();
                const month = date.getMonth();

                if (year === 2023 && monthsToShow.includes(month)) {
                    const variation = ((parseFloat(curr[4]) - parseFloat(prev[4])) / parseFloat(prev[4])) * 100;

                    if (variation > 0) positiveCount++;
                    totalVariation += variation;

                    const moisNom = date.toLocaleString('fr-FR', { month: 'long' });
                    tbody.insertAdjacentHTML('beforeend', `
                        <tr>
                            <td>${symbol}</td>
                            <td>${moisNom} ${year}</td>
                            <td style="color:${variation >= 0 ? 'green' : 'red'}">${variation.toFixed(2)}%</td>
                        </tr>
                    `);
                }
            }

            if (positiveCount === 4) {
                // Ajoute crypto + total variation arrondi √† 2 d√©cimales
                positiveList.push({symbol, totalVariation: totalVariation.toFixed(2)});
            }

        } catch (e) {
            tbody.insertAdjacentHTML('beforeend', `<tr><td>${symbol}</td><td colspan="2" style="color:red;">Erreur: ${e.message}</td></tr>`);
        }
        processed++;
        updateProgress(processed, targetCryptos.length);
    }

    // Affichage ligne par ligne avec total variation
    if (positiveList.length > 0) {
        positiveDiv.innerHTML = positiveList
          .map(p => `<div>${p.symbol} - ${p.totalVariation}%</div>`)
          .join('');
    } else {
        positiveDiv.innerHTML = "<div>Aucune crypto positive sur les 4 mois.</div>";
    }
}

main();
</script>

</body>
</html>
