<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Analyse Liquidation Crypto</title>
  <script>
    async function fetchPrice(symbol = "BTCUSDT") {
      const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${symbol}`);
      const data = await res.json();
      return parseFloat(data.price);
    }

    function calculateLiquidationLevels(price, leverage) {
      const liquidationLong = price * (1 - 1 / leverage);
      const liquidationShort = price * (1 + 1 / leverage);
      const global = (liquidationLong + liquidationShort) / 2;
      return { liquidationLong, liquidationShort, global };
    }

    function getAdvice(currentPrice, globalLiquidationPrice) {
      if (currentPrice < globalLiquidationPrice) {
        return {
          message: "⚠️ Le prix est SOUS le seuil global de liquidation → Risque accru de liquidation LONG. Signal SHORT.",
          type: "SHORT"
        };
      } else {
        return {
          message: "✅ Le prix est AU-DESSUS du seuil global de liquidation → Risque accru de liquidation SHORT. Signal LONG.",
          type: "LONG"
        };
      }
    }

    function generateTradeTable(type, price, leverage) {
      const table = document.getElementById("tradeTableBody");
      table.innerHTML = "";

      const tpRates = [0.01, 0.015, 0.02]; // +1%, +1.5%, +2%
      const slRates = [0.005, 0.0075, 0.01]; // -0.5%, -0.75%, -1%

      tpRates.forEach((tpRate, index) => {
        const slRate = slRates[index];
        const entry = price;
        const tp = type === "LONG" ? entry * (1 + tpRate) : entry * (1 - tpRate);
        const sl = type === "LONG" ? entry * (1 - slRate) : entry * (1 + slRate);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${type}</td>
          <td>${entry.toFixed(2)} USDT</td>
          <td>${tp.toFixed(2)} USDT</td>
          <td>${sl.toFixed(2)} USDT</td>
          <td>${leverage}x</td>
        `;
        table.appendChild(row);
      });
    }

    async function update() {
      const symbol = document.getElementById("symbol").value;
      const leverage = parseFloat(document.getElementById("leverage").value);
      const price = await fetchPrice(symbol);
      const { liquidationLong, liquidationShort, global } = calculateLiquidationLevels(price, leverage);
      const advice = getAdvice(price, global);

      document.getElementById("currentPrice").innerText = price.toFixed(2) + " USDT";
      document.getElementById("liqLong").innerText = liquidationLong.toFixed(2) + " USDT";
      document.getElementById("liqShort").innerText = liquidationShort.toFixed(2) + " USDT";
      document.getElementById("globalLiq").innerText = global.toFixed(2) + " USDT";
      document.getElementById("advice").innerText = advice.message;

      generateTradeTable(advice.type, price, leverage);
    }
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
    }
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    th {
      background-color: #eee;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Prix global de liquidation & Conseil</h2>
    <label>Crypto :</label>
    <select id="symbol">
      <option value="BTCUSDT">BTC/USDT</option>
      <option value="ETHUSDT">ETH/USDT</option>
    </select>

    <label style="margin-left: 20px;">Levier :</label>
    <select id="leverage">
      <option value="5">5x</option>
      <option value="10">10x</option>
      <option value="20" selected>20x</option>
      <option value="50">50x</option>
    </select>

    <button onclick="update()">Calculer</button>

    <p><strong>Prix actuel :</strong> <span id="currentPrice">---</span></p>
    <p><strong>Prix liquidation Long :</strong> <span id="liqLong">---</span></p>
    <p><strong>Prix liquidation Short :</strong> <span id="liqShort">---</span></p>
    <p><strong>Prix global de liquidation estimé :</strong> <span id="globalLiq">---</span></p>
    <p id="advice" style="font-weight: bold; color: #c0392b;"></p>
  </div>

  <div class="card">
    <h3>Plan de Trading Automatique</h3>
    <table>
      <thead>
        <tr>
          <th>Position</th>
          <th>Prix d'entrée</th>
          <th>Take Profit (TP)</th>
          <th>Stop Loss (SL)</th>
          <th>Levier</th>
        </tr>
      </thead>
      <tbody id="tradeTableBody"></tbody>
    </table>
  </div>
</body>
</html>
