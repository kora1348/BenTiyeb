<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Variations 5m — Sélection Binance Futures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#0f172a; --card:#111827; --muted:#94a3b8;
      --ok:#10b981; --bad:#ef4444; --text:#e5e7eb; --border:#1f2937; --warn:#f59e0b;
    }
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{padding:18px;border-bottom:1px solid var(--border)}
    h1{margin:0;font-size:18px}
    .sub{color:var(--muted);font-size:13px;margin-top:6px}
    .wrap{padding:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{border-bottom:1px solid var(--border);padding:8px 10px;white-space:nowrap}
    th{position:sticky;top:0;background:var(--card);text-align:left}
    .pos{color:var(--ok)}
    .neg{color:var(--bad)}
    .na{color:var(--muted)}
    .warn{color:var(--warn)}
    .sum{font-weight:600}
  </style>
</head>
<body>
  <header>
    <h1>Variation 5m — Sélection de cryptos Futures</h1>
    <div class="sub">07/10/25 09:25 • 09/10/25 10:15 • 09/10/25 21:35 • 09/10/25 22:05 • 10/10/25 15:15</div>
  </header>

  <div class="wrap">
    <div class="card">
      <p style="color:var(--muted);font-size:13px;margin-bottom:8px">
        Calcul = (Close − Open) / Open × 100 sur la bougie 5m correspondant à l’heure exacte (Europe/Brussels)
      </p>
      <table id="table">
        <thead>
          <tr>
            <th>Symbole</th>
            <th>07/10 09:25</th>
            <th>09/10 10:15</th>
            <th>09/10 21:35</th>
            <th>09/10 22:05</th>
            <th>10/10 15:15</th>
            <th>Total (∑)</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- Lignes générées -->
        </tbody>
      </table>
      <p id="progress" class="warn">Chargement…</p>
    </div>
  </div>

  <script>
    const BASE = "https://fapi.binance.com";
    const INTERVAL = "5m";
    const BRUSSELS_OFFSET = 2; // UTC+2 à ces dates

    // ⚠️ Liste telle que fournie dans ton dernier message
    const symbols = [
      "JELLYJELLYUSDT",
      "MYXUSDT",
      "PROVEUSDT",
      "TRUTHUSDT",
      "USTCUSDT"
    ];

    const points = [
      { label:"07/10 09:25", y:2025, m:10, d:7,  h:9,  min:25 },
      { label:"09/10 10:15", y:2025, m:10, d:9,  h:10, min:15 },
      { label:"09/10 21:35", y:2025, m:10, d:9,  h:21, min:35 },
      { label:"09/10 22:05", y:2025, m:10, d:9,  h:22, min:5 },
      { label:"10/10 15:15", y:2025, m:10, d:10, h:15, min:15 }
    ];

    const tbody = document.getElementById("tbody");
    const progress = document.getElementById("progress");

    function brusselsToUtcMs(y,m,d,h,min){
      return Date.UTC(y, m-1, d, h - BRUSSELS_OFFSET, min);
    }

    async function fetchKline(symbol, openTimeMs){
      const url = `${BASE}/fapi/v1/klines?symbol=${symbol}&interval=${INTERVAL}&startTime=${openTimeMs}&limit=1`;
      const r = await fetch(url);
      if(!r.ok) return null;
      const data = await r.json();
      if(!data.length) return null;
      const k = data[0];
      const openTime = +k[0];
      if(openTime !== openTimeMs) return null;
      const open = parseFloat(k[1]);
      const close = parseFloat(k[4]);
      if(!isFinite(open) || !isFinite(close) || open === 0) return null;
      return ((close - open) / open) * 100;
    }

    function fmtPct(v){
      if(v == null) return `<span class="na">—</span>`;
      const cls = v >= 0 ? "pos" : "neg";
      return `<span class="${cls}">${v.toFixed(2)}%</span>`;
    }

    function fmtSum(v, count){
      if(count === 0) return `<span class="na">—</span>`;
      const cls = v >= 0 ? "pos" : "neg";
      return `<span class="sum ${cls}">${v.toFixed(2)}%</span>`;
    }

    async function main(){
      let done = 0;
      for(const symbol of symbols){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${symbol}</td>`;
        // cellules des 5 timestamps
        for(let i=0;i<points.length;i++){
          const td = document.createElement("td");
          td.innerHTML = `<span class="warn">…</span>`;
          tr.appendChild(td);
        }
        // cellule Total
        const tdTotal = document.createElement("td");
        tdTotal.innerHTML = `<span class="na">—</span>`;
        tr.appendChild(tdTotal);

        tbody.appendChild(tr);

        // calculs
        let sum = 0;
        let count = 0;

        for(let i=0;i<points.length;i++){
          const t = brusselsToUtcMs(points[i].y, points[i].m, points[i].d, points[i].h, points[i].min);
          try{
            const pct = await fetchKline(symbol, t);
            tr.children[i+1].innerHTML = fmtPct(pct);
            if(pct != null) { sum += pct; count++; }
          }catch{
            tr.children[i+1].innerHTML = `<span class="na">—</span>`;
          }
          // petite pause anti rate-limit
          await new Promise(r=>setTimeout(r,100));
        }

        tdTotal.innerHTML = fmtSum(sum, count);
        done++;
        if(done % 2 === 0) progress.textContent = `Progression : ${done}/${symbols.length}`;
      }
      progress.textContent = "Terminé ✅";
    }

    main();
  </script>
</body>
</html>
