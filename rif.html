<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Liquidations Binance - Alerte Short & Long</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background-color: #0e1621;
color: #e3eaf2;
margin: 0;
padding: 20px;
}
.container {
max-width: 1000px;
margin: 0 auto;
background: #17212b;
padding: 20px;
border-radius: 12px;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}
h1 {
color: #64b5f6;
text-align: center;
margin-bottom: 20px;
}
.alert-banner {
background: #1f2d3b;
padding: 12px;
border-radius: 8px;
margin-bottom: 15px;
font-weight: bold;
border-left: 4px solid #64b5f6;
line-height: 1.5em;
white-space: pre-line;
}
.alert-short {
border-left-color: #ff5252;
}
.alert-long {
border-left-color: #4caf50;
}
select {
width: 100%;
padding: 12px;
background: #2b3a4a;
color: white;
border: 1px solid #3d4f62;
border-radius: 6px;
font-size: 16px;
margin-bottom: 20px;
}
.chart-container {
background: #1f2d3b;
padding: 15px;
border-radius: 10px;
margin-bottom: 20px;
border-left: 4px solid #64b5f6;
}
canvas {
width: 100% !important;
height: 350px !important;
}
.price-info {
background: #252b3b;
padding: 15px;
border-radius: 8px;
margin-top: 15px;
}
.red { color: #ff5252; font-weight: bold; }
.green { color: #4caf50; font-weight: bold; }
.highlight {
background: #3a4466;
padding: 2px 6px;
border-radius: 4px;
}
.loading {
color: #64b5f6;
text-align: center;
padding: 20px;
font-style: italic;
}
</style>
</head>
<body>
<div class="container">
<h1>ðŸ”¥ Alerte Liquidations Binance Futures</h1>

<div id="shortAlert" class="alert-banner alert-short" style="display: none;"></div>
<div id="longAlert" class="alert-banner alert-long" style="display: none;"></div>

<select id="cryptoSelect">
<option value="">Chargement des cryptos...</option>
</select>

<div class="chart-container">
<canvas id="priceChart"></canvas>
</div>

<div class="price-info" id="priceInfo">
SÃ©lectionnez une cryptomonnaie pour voir les donnÃ©es dÃ©taillÃ©es.
</div>
</div>

<script>
let priceChart = null;
let allSymbols = [];
let shortAlerts = [];
let longAlerts = [];

async function loadAllSymbols() {
try {
const res = await axios.get('https://fapi.binance.com/fapi/v1/exchangeInfo');
allSymbols = res.data.symbols
.filter(s => s.contractType === 'PERPETUAL' && s.quoteAsset === 'USDT')
.map(s => s.symbol);
updateSelect();
await checkAllLiquidations();
} catch (e) {
console.error("Erreur de chargement des symboles:", e);
}
}

async function checkAllLiquidations() {
shortAlerts = [];
longAlerts = [];
const shortBox = document.getElementById('shortAlert');
const longBox = document.getElementById('longAlert');
shortBox.style.display = 'none';
longBox.style.display = 'none';
shortBox.innerHTML = '';
longBox.innerHTML = '';

const toCheck = allSymbols.slice(0, 50);

const tasks = toCheck.map(async (symbol) => {
try {
const data = await fetchPriceData(symbol);
const last = data[data.length - 1].close;
const zones = calculateLiquidationZones(data);
const distanceShort = ((zones.short - last) / last) * 100;
const distanceLong = ((last - zones.long) / last) * 100;

if (distanceShort < 4)
shortAlerts.push({ symbol, price: last.toFixed(4), liq: zones.short.toFixed(4), dist: distanceShort.toFixed(2) });

if (distanceLong < 4)
longAlerts.push({ symbol, price: last.toFixed(4), liq: zones.long.toFixed(4), dist: distanceLong.toFixed(2) });

} catch (e) {
console.warn(`Erreur avec ${symbol}:`, e.message);
}
});

await Promise.all(tasks);

if (shortAlerts.length > 0) {
shortBox.innerHTML = shortAlerts.map(s =>
`ðŸ“‰ ${s.symbol} â€” Prix: ${s.price}, Liquidation Short: ${s.liq} (Distance: +${s.dist}%)`
).join('\n');
shortBox.style.display = 'block';
document.getElementById('cryptoSelect').value = shortAlerts[0].symbol;
loadChart();
}

if (longAlerts.length > 0) {
longBox.innerHTML = longAlerts.map(s =>
`ðŸ“ˆ ${s.symbol} â€” Prix: ${s.price}, Liquidation Long: ${s.liq} (Distance: -${s.dist}%)`
).join('\n');
longBox.style.display = 'block';
}
}

async function fetchPriceData(symbol) {
const res = await axios.get(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=1d&limit=30`);
return res.data.map(d => ({
time: new Date(d[0]),
open: +d[1], high: +d[2], low: +d[3], close: +d[4]
}));
}

function calculateLiquidationZones(data) {
const highs = data.map(d => d.high);
const lows = data.map(d => d.low);
return {
short: Math.max(...highs) * 0.985,
long: Math.min(...lows) * 1.015
};
}

function updateSelect() {
const select = document.getElementById('cryptoSelect');
select.innerHTML = allSymbols.map(s => `<option value="${s}">${s}</option>`).join('');
}

async function loadChart() {
const symbol = document.getElementById('cryptoSelect').value;
if (!symbol) return;

document.getElementById('priceInfo').innerHTML = `<div class="loading">Chargement des donnÃ©es pour ${symbol}...</div>`;

try {
const data = await fetchPriceData(symbol);
const zones = calculateLiquidationZones(data);
updateChart(symbol, data, zones);
updateInfo(symbol, data, zones);
} catch (e) {
document.getElementById('priceInfo').innerHTML = `<span class="red">Erreur : ${e.message}</span>`;
}
}

function updateChart(symbol, data, zones) {
const ctx = document.getElementById('priceChart').getContext('2d');
if (priceChart) priceChart.destroy();

priceChart = new Chart(ctx, {
type: 'line',
data: {
labels: data.map(d => d.time.toLocaleDateString()),
datasets: [{
label: `${symbol} Prix`,
data: data.map(d => d.close),
borderColor: '#64b5f6',
tension: 0.1,
pointRadius: 0,
borderWidth: 2
}]
},
options: {
responsive: true,
plugins: {
legend: { display: false },
annotation: {
annotations: {
shortLine: {
type: 'line',
yMin: zones.short,
yMax: zones.short,
borderColor: '#ff5252',
borderWidth: 2,
borderDash: [5, 5],
label: {
content: `Short ~${zones.short.toFixed(2)}`,
display: true,
backgroundColor: 'rgba(255,82,82,0.7)'
}
},
longLine: {
type: 'line',
yMin: zones.long,
yMax: zones.long,
borderColor: '#4caf50',
borderWidth: 2,
borderDash: [5, 5],
label: {
content: `Long ~${zones.long.toFixed(2)}`,
display: true,
backgroundColor: 'rgba(76,175,80,0.7)'
}
}
}
}
},
scales: {
x: { grid: { color: '#2b3a4a' } },
y: { grid: { color: '#2b3a4a' } }
}
}
});
}

function updateInfo(symbol, data, zones) {
const last = data[data.length - 1].close;
const distShort = ((zones.short - last) / last * 100).toFixed(2);
const distLong = ((last - zones.long) / last * 100).toFixed(2);

document.getElementById('priceInfo').innerHTML = `
<strong>${symbol}</strong> â€” Dernier prix: <span class="highlight">${last.toFixed(4)}</span><br><br>
<span class="red">ðŸ“‰ Liquidation Short: ${zones.short.toFixed(4)}</span><br>
Distance: <span class="red">+${distShort}%</span><br><br>
<span class="green">ðŸ“ˆ Liquidation Long: ${zones.long.toFixed(4)}</span><br>
Distance: <span class="green">-${distLong}%</span>
`;
}

document.addEventListener('DOMContentLoaded', () => {
loadAllSymbols();
document.getElementById('cryptoSelect').addEventListener('change', loadChart);
setInterval(checkAllLiquidations, 5 * 60 * 1000); // toutes les 5 minutes
});
</script>
</body>
</html>